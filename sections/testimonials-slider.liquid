{% style %}
  #shopify-section-{{ section.id }} {
    --testimonials-slider-button-color: {{ section.settings.button_color }};
    --testimonial-slide-border-color: {{ section.settings.testimonial_border_color }};
  }
{% endstyle %}

{% capture slider_settings %}
	{
		"slidesPerView": "auto",
		"speed": 500,
    "centeredSlides": true,
    "spaceBetween": 10,
		"loop": true,
    "initialSlide": 1,
		"breakpoints": {
			"768": {
				"spaceBetween": 20
			}
		}
	}
{% endcapture  %}

<div class="testimonials-slider__container">
  <div class="testimonials-slider__header">
    {%- unless section.settings.heading == blank -%}
      <h2 class="testimonials-slider__heading">{{ section.settings.heading }}</h2>
    {%- endunless -%}

    {%- unless section.settings.button_text == blank -%}
      <a href="{{ section.settings.button_url }}" class="testimonials-slider__button">
        {{ section.settings.button_text }}
      </a>
    {%- endunless -%}
  </div>

  <div class="swiper testimonials-slider__swiper" {% render 'slider-attribute', config: slider_settings %}>
    <div class="swiper-wrapper testimonials-slider__swiper-wrapper">
      {%- for block in section.blocks -%}
        <div class="swiper-slide testimonial-slide">
          <div class="testimonial-slide__top">
            <div class="testimonial-slide__author-box">
              {%- unless block.settings.testimonial_avatar == blank -%}
                {{ block.settings.testimonial_avatar | image_url: width: 128 | image_tag: class: 'testimonial-slide__avatar', loading: 'lazy' }}
              {%- endunless -%}

              <div class="testimonial-slide__author-info">
                {%- unless block.settings.testimonial_author == blank -%}
                  <p class="testimonial-slide__author">{{ block.settings.testimonial_author }}</p>
                {%- endunless -%}

                <div class="testimonial-slide__rating">
                  {%- for index in (1..5) -%}
                    {%- liquid
                      assign rating_icon_class = 'testimonial-slide__rating-icon'

                      if index > block.settings.testimonial_rating 
                        assign rating_icon_class = rating_icon_class | append: ' testimonial-slide__rating-icon--empty'
                      endif
                    -%}

                    {% render 'icon', icon: 'star-2', class: rating_icon_class %}
                  {%- endfor -%}
                </div>
              </div>
            </div>

            {%- unless block.settings.testimonial_info == blank -%}
              <p class="testimonial-slide__info">{{ block.settings.testimonial_info }}</p>
            {%- endunless -%}
          </div>

          {%- unless block.settings.testimonial_image == blank -%}
            {{ block.settings.testimonial_image | image_url: width: 640 | image_tag: class: 'testimonial-slide__image'  }}
          {%- endunless -%}

          <div class="testimonial-slide__text">{{ block.settings.testimonial_text }}</div>
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Testimonials slider",
  "tag": "section",
  "class": "testimonials-slider",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button url"
    },
    {
      "type": "header",
      "content": "Color"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button color",
      "default": "#876B44"
    },
    {
      "type": "color",
      "id": "testimonial_border_color",
      "label": "Testimonial border color",
      "default": "#876B44"
    }
  ],
  "blocks": [
    {
      "type": "testimonial-slide",
      "name": "Testimonial slide",
      "settings": [
        {
          "type": "text",
          "id": "testimonial_author",
          "label": "Author"
        },
        {
          "type": "image_picker",
          "id": "testimonial_avatar",
          "label": "Avatar"
        },
        {
          "type": "range",
          "id": "testimonial_rating",
          "label": "Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "text",
          "id": "testimonial_info",
          "label": "Info"
        },
        {
          "type": "image_picker",
          "id": "testimonial_image",
          "label": "Image"
        },
        {
          "type": "richtext",
          "id": "testimonial_text",
          "label": "Text"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials slider"
    }
  ]
}
{% endschema %}