{%- style -%}
  #shopify-section-{{ section.id }} {
    --background-media-text-image-position: {{ section.settings.image_position_desktop }};
    --background-media-text-content-width: {{ section.settings.content_width }}%;
    --background-media-text-content-background-color-rgb: {{ section.settings.content_background_color.rgb }};
    --background-media-text-button-color: {{ section.settings.button_color }};
  }

  @media screen and (max-width: 768px) {
    #shopify-section-{{ section.id }} {
      --background-media-text-content-position: {{ section.settings.content_layout_mobile }};
      --background-media-text-image-position: {{ section.settings.image_position_mobile }};
    }

    .background-media-text--{{ section.id }} {
      background-image: url({{ section.settings.image | img_url: '1x1' }});
    }
  }
{%- endstyle -%}

{% liquid
  assign product = section.settings.product

  if product.compare_at_price_varies
    assign product_min_compare_price = product.price_max
    for variant in product.variants
      unless variant.title contains 'Sample' or product_min_compare_price < variant.compare_at_price
        assign product_min_compare_price = variant.compare_at_price
      endunless
    endfor

    assign compare_price = product_min_compare_price | money
  else
    assign compare_price = product.compare_at_price | money
  endif
%}

<div class="background-media-text--image-{{ section.settings.image_position_mobile }} {% unless section.settings.full_width %}page-width{% endunless %}">
  <div
    data-section-id="{{ section.id }}"
    data-section-type="background-image"
    class="background-media-text background-media-text--{{ section.id }} background-media-text--{{ section.settings.height }} loaded"
    data-aos="background-media-text__animation">

    <div
      class="background-media-text__container">
      {% if section.settings.video_desktop != blank %}
        {% render 'video',
          video:  section.settings.video_desktop,
          video_mobile: section.settings.video_mobile,
          media_request: 768,
          autoplay: true,
          playsinline:  true,
          controls:  false,
          loop:  true,
          muted:  true,
          class: 'background-media-text__video'
        %}
      {%- elsif section.settings.image != blank -%}
        {% style %}
          .background-media-text__image--{{ section.id }}{
            object-position: {{ section.settings.focal_point }};
          }
        {% endstyle %}

        {% assign classes = 'image-fit background-media-text__image background-media-text__image--' | append: section.id %}

        {% render 'picture',
          image: section.settings.image,
          image_mobile: section.settings.image_mobile,
          mobile_breakpoint: 768,
          loading: 'lazy',
          fetchpriority: 'low',
          class: classes %}
      {%- else -%}
        {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
      {%- endif -%}

      {%- unless section.settings.product == blank -%}
        <div class="background-media-text__product-wrapper background-media-text--{{ section.settings.product_card_position }}">
          <a class="background-media-text__product-card" href="{{ section.settings.product.url }}">
            {{ section.settings.product.featured_image | image_url: width: 164 | image_tag: class: 'product-card__image'  }}

            <div class="product-card__info">
              <p class="product-card__title">{{ section.settings.product.title }}</p>

              <p class="product-card__price">{{ compare_price }}</p>
            </div>
          </a>
        </div>
      {%- endunless -%}
    </div>
    {%- if section.settings.subtitle != blank or section.settings.title != blank or section.settings.text != blank -%}
      <div class="background-media-text__inner">
        <div class="background-media-text__aligner background-media-text--{{ section.settings.layout }} background-media-text--{{ section.settings.content_position }}">
          <div class="animation-cropper">
            <div class="animation-contents">
              <div class="background-media-text__text">
                {%- if section.settings.subtitle -%}
                  <p class="h5">{{ section.settings.subtitle }}</p>
                {%- endif -%}
                {%- if section.settings.title != blank -%}
                  <h2 class="background-media-text-custom__heading">{{ section.settings.title | escape }}</h2>
                {%- endif -%}
                {%- if section.settings.text != blank -%}
                  <div class="rte background-media-text__subtext">{{ section.settings.text }}</div>
                {%- endif -%}
                <div class="background-media-text__button-wrapper">
                  {%- if section.settings.button_label != blank and section.settings.button_link != blank -%}
                    <a href="{{ section.settings.button_link }}" class="button btn">
                      {{ section.settings.button_label }}
                    </a>
                  {%- endif -%}

                  {%- if section.settings.button_label_2 != blank and section.settings.button_link_2 != blank -%}
                    <a href="{{ section.settings.button_link_2 }}" class="button btn button--secondary">
                      {{ section.settings.button_label_2 }}
                    </a>
                  {%- endif -%}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    {%- endif -%}
  </div>

  <div class="background-media-text__spacer background-media-text--{{ section.settings.height }}"></div>
</div>

{% schema %}
{
  "name": "Image with content",
  "class": "index-section--flush background-media-text-custom",
  "settings": [
    {
      "type": "text",
      "id": "subtitle",
      "label": "t:sections.background-image-text.settings.subtitle.label",
      "default": "Impressive"
    },
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.background-image-text.settings.title.label",
      "default": "Large image with text box"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "t:sections.background-image-text.settings.text.label",
      "default": "<p>Pair large text with a full-width image to draw attention to an important detail of your brand or product line.</p>"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "t:sections.background-image-text.settings.button_label.label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "t:sections.background-image-text.settings.button_link.label"
    },
    {
      "type": "text",
      "id": "button_label_2",
      "label": "Button label"
    },
    {
      "type": "url",
      "id": "button_link_2",
      "label": "Button link"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "select",
      "id": "product_card_position",
      "label": "Product card position",
      "default": "bottom-right",
      "options": [
        {
          "value": "top-left",
          "label": "Top left"
        },
        {
          "value": "top-center",
          "label": "Top center"
        },
        {
          "value": "top-right",
          "label": "Top right"
        },
        {
          "value": "middle-left",
          "label": "Middle left"
        },
        {
          "value": "middle",
          "label": "Middle"
        },
        {
          "value": "middle-right",
          "label": "Middle right"
        },
        {
          "value": "bottom-left",
          "label": "Bottom left"
        },
        {
          "value": "bottom-center",
          "label": "Bottom center"
        },
        {
          "value": "bottom-right",
          "label": "Bottom right"
        }
      ]
    },

    {
      "type": "header",
      "content": "Image & Video"
    },
    {
      "type": "video",
      "id": "video_desktop",
      "label": "Video on desktop"
    },
    {
      "type": "video",
      "id": "video_mobile",
      "label": "Video on mobile"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image on desktop"
    },
    {
      "type": "image_picker",
      "id": "image_mobile",
      "label": "Image on mobile"
    },
    {
      "type": "select",
      "id": "image_position_desktop",
      "label": "Image Layout (Desktop)",
      "default": "absolute",
      "options": [
        {
          "value": "absolute",
          "label": "Overlay"
        },
        {
          "value": "relative",
          "label": "Inline"
        }
      ]
    },
    {
      "type": "select",
      "id": "image_position_mobile",
      "label": "Image Layout (Mobile)",
      "default": "relative",
      "options": [
        {
          "value": "absolute",
          "label": "Overlay"
        },
        {
          "value": "relative",
          "label": "Inline"
        }
      ]
    },
    {
      "type": "select",
      "id": "focal_point",
      "label": "t:sections.background-image-text.settings.focal_point.label",
      "info": "t:sections.background-image-text.settings.focal_point.info",
      "default": "center",
      "options": [
        {
          "value": "20% 0",
          "label": "t:sections.background-image-text.settings.focal_point.options.20_0.label"
        },
        {
          "value": "top",
          "label": "t:sections.background-image-text.settings.focal_point.options.top.label"
        },
        {
          "value": "80% 0",
          "label": "t:sections.background-image-text.settings.focal_point.options.80_0.label"
        },
        {
          "value": "20% 50%",
          "label": "t:sections.background-image-text.settings.focal_point.options.20_50.label"
        },
        {
          "value": "center",
          "label": "t:sections.background-image-text.settings.focal_point.options.center.label"
        },
        {
          "value": "80% 50%",
          "label": "t:sections.background-image-text.settings.focal_point.options.80_50.label"
        },
        {
          "value": "20% 100%",
          "label": "t:sections.background-image-text.settings.focal_point.options.20_100.label"
        },
        {
          "value": "bottom",
          "label": "t:sections.background-image-text.settings.focal_point.options.bottom.label"
        },
        {
          "value": "80% 100%",
          "label": "t:sections.background-image-text.settings.focal_point.options.80_100.label"
        }
      ]
    },
    {
      "type": "select",
      "id": "content_position",
      "label": "Content position",
      "default": "top-left",
      "options": [
        {
          "value": "top-left",
          "label": "Top left"
        },
        {
          "value": "top-center",
          "label": "Top center"
        },
        {
          "value": "top-right",
          "label": "Top right"
        },
        {
          "value": "middle-left",
          "label": "Middle left"
        },
        {
          "value": "middle",
          "label": "Middle"
        },
        {
          "value": "middle-right",
          "label": "Middle right"
        },
        {
          "value": "bottom-left",
          "label": "Bottom left"
        },
        {
          "value": "bottom-center",
          "label": "Bottom center"
        },
        {
          "value": "bottom-right",
          "label": "Bottom right"
        }
      ]
    },
    {
      "type": "range",
      "id": "height",
      "label": "t:sections.background-image-text.settings.height.label",
      "default": 550,
      "min": 450,
      "max": 750,
      "step": 100,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width"
    },
    {
      "type": "range",
      "id": "content_width",
      "label": "Content width",
      "min": 10,
      "max": 100,
      "step": 10,
      "unit": "%",
      "default": 40
    },
    {
      "type": "header",
      "content": "Color"
    },
    {
      "type": "color",
      "id": "content_background_color",
      "label": "Content background color",
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button color",
      "default": "#876B44"
    }
  ],
  "presets": [
    {
      "name": "Image with content"
    }
  ]
}
{% endschema %}
