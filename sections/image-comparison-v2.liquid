{%- liquid
  assign height = section.settings.height
  assign background_brightnes = section.settings.color | brightness_difference: '#000'
-%}

{% style %}
  #shopify-section-{{ section.id }} {
    --image-comparison-border-color: {{ section.settings.border_color }};
    --image-comparison-button-color: {{ section.settings.button_color }};
  }

  .comparison-{{ section.id }} {
    height: {{ height }}px;
  }

  @media only screen and (max-width: 768px) {
    .comparison-{{ section.id }} {
      height: {{ height | divided_by: 2 }}px;
    }
  }

  .comparison-{{ section.id }} .comparison__button {
    background-color: {{ section.settings.color }};
  }

  {% if background_brightnes < 125 %}
    .comparison-{{ section.id }} .comparison__button svg {
      fill: #fff;
    }
  {% else %}
    .comparison-{{ section.id }} .comparison__button svg {
      fill: #000;
    }
  {% endif %}

  .comparison-{{ section.id }} .comparison__button::before {
    height: {{ height | divided_by: 2 }}px;
    bottom: 40px;
  }

  .comparison-{{ section.id }} .comparison__button::after {
    height: {{ height | divided_by: 2 }}px;
    top: 40px;
  }

  @media only screen and (max-width: 768px) {
    .comparison-{{ section.id }} .comparison__button::before {
      bottom: 42px;
    }

    .comparison-{{ section.id }} .comparison__button::after {
      top: 42px;
    }
  }
{% endstyle %}

<div class="index-section image-comparison-custom {% unless section.settings.full_width %}page-widths{% endunless %}">
  {% if section.settings.heading != blank %}
    <div class="section-header page-width">
      <h2 class="image-comparison-custom__heading">{{ section.settings.heading }}</h2>

      {%- unless section.settings.button_text == blank -%}
        <a href="{{ section.settings.button_url }}" class="button btn button--secondary image-comparison-custom--desktop">
          {{ section.settings.button_text }}
        </a>
      {%- endunless -%}
    </div>
  {% endif %}
  <div class="image-comparison-custom__wrapper {% unless section.settings.fullwidth %}page-width{% endunless %}">
    {% unless section.settings.product == blank %}
      {% render 'product-card', product: section.settings.product, hide_description: true, class: 'image-comparison-custom__card', hide-tags: true %}
    {% endunless %}

    <image-compare class="comparison comparison-{{ section.id }} comparison--style-{{ section.settings.slider_style }}" data-section-id="{{ section.id }}">
      {% for block in section.blocks %}
        {% if forloop.index == 1 %}
          <div class="comparison__draggable" data-draggable> 
            <h3 class="comparison--before-text">Before</h3>
        {% endif %}

        {% if block.settings.image != blank %}
          <img class="comparison__image comparison__image--{{ forloop.index}} {% if block.settings.blur %}blur{% endif %}" src="{{ block.settings.image | img_url: '2000x' }})" alt="{{ block.settings.image.alt }}" {% if forloop.index == 1 %}data-primary-image{% else %}data-secondary-image{% endif %} {{ block.shopify_attributes }}>
        {% else %}
          {{ 'image' | placeholder_svg_tag: 'placeholder-svg comparison__image' }}
        {% endif %}

        {% if forloop.index == 1 %}</div>{% endif %}
      {% endfor %}
      <button class="comparison__button" data-button>
        <img src="{{ 'comparison-icon.svg' | asset_url }}" width="32" height="12" loading="lazy">
      </button>

      <h3 class="comparison--after-text">After</h3>
    </image-compare>
  </div>

  {%- unless section.settings.button_text == blank -%}
    <div class="image-comparison-custom__button-wrapper page-width">
      <a href="{{ section.settings.button_url }}" class="image-comparison-custom__button image-comparison-custom--mobile">
        {{ section.settings.button_text }}
      </a>
    </div>
  {%- endunless -%}
</div>

{% schema %}
{
  "name": "Image compa",
  "class": "image-comparison-section",
  "max_blocks": 2,
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:sections.image-comparison.settings.heading.label"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button text"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button url"
    },
    {
      "type": "checkbox",
      "id": "fullwidth",
      "label": "t:sections.image-comparison.settings.fullwidth.label",
      "default": true
    },
    {
      "type": "select",
      "id": "slider_style",
      "label": "t:sections.image-comparison.settings.slider_style.label",
      "default": "classic",
      "options": [
        {
          "value": "classic",
          "label": "t:sections.image-comparison.settings.slider_style.options.classic.label"
        },
        {
          "value": "minimal",
          "label": "t:sections.image-comparison.settings.slider_style.options.minimal.label"
        }
      ]
    },
    {
      "type": "range",
      "id": "height",
      "label": "t:sections.image-comparison.settings.height.label",
      "default": 600,
      "min": 400,
      "max": 900,
      "step": 10,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "t:sections.image-comparison.settings.header_colors"
    },
    {
      "type": "color",
      "id": "color",
      "label": "t:sections.image-comparison.settings.color.label",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#876B44"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button color",
      "default": "#876B44"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "t:sections.image-comparison.blocks.image.name",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.image-comparison.blocks.image.settings.image.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image comparison v2",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}
